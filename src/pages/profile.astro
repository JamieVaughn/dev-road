---
import Home from '../layouts/Home.astro'
import { checkAuth} from '../lib/checkAuth'

const { cookies, redirect } = Astro;

const auth = await checkAuth({cookies, redirect})
  .then(data => data)
  .catch(err => console.log(err));
---

<Home>
  <div>
    <div class="center">
      <h1>My Profile</h1>
      <a href="/logout" role="button" class="ghost">Not You? Click here</a>
    </div>
    <article>
      <div style="flex: 0 2 40vw; text-align: center;">
        <img
          src=`https://api.dicebear.com/7.x/thumbs/svg?seed=${auth?.user?.email.split('@')[0]}`
          alt="avatar"
          style="max-height: 300px;"
        />
      </div>
      <div>
        <h2>{auth?.user?.email.split('@')[0]}</h2>
        <div class="email-info">
          <h6>Email:</h6>
          <p class="muted">{auth?.user?.email}</p>
          <p class="badge">{auth?.user?.identities[0].identity_data.email_verified ? "verified" : "unverified"}</p>
        </div>
        <p>Confirmed at: <span class="muted">{new Date(auth?.user?.email_confirmed_at).toLocaleString()}</span></p>
        <p>Joined: <span class="muted">{new Date(auth?.user?.created_at).toLocaleString()}</span></p>
        <p>Last log in: <span class="muted">{new Date(auth?.user?.last_sign_in_at).toLocaleString()}</span></p>
      </div>
    </article>
    <article class="start">
      <div>
        <h2>Additional Info</h2>
        <p>Feel free to add your name and LinkedIn Account URL to your profile! Also tell us about some of your hobbies and interests, so class project topics can be personalized for you!</p>
      </div>
      <form action="/">
        <div class="flex">
          <input type="text" id="firstname" placeholder="First Name">
          <input type="text" id="lastname" placeholder="Last Name">
        </div>
        <input type="text" id="fcc" placeholder="Freecodecamp Profile URL">
        <div class="flex">
          <input type="text" id="linkedin" placeholder="LinkedIn Profile URL">
          <input type="text" id="discord" placeholder="Discord Username">
        </div>
          <textarea name="hobbies" id="hobbies" placeholder="Your Hobbies & Interests" cols="30" rows="6"></textarea>
        <button type="submit">Submit</button>
      </form>
    </article>
    <article>
      <iframe src="https://discord.com/widget?id=831668785274421300&theme=dark" width="100%" height="500"  allowtransparency="true" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
    </article>
  </div>
</Home>

<style>
  .email-info {
    display: flex; 
    gap: 0.5em; 
    align-items: center;
    margin-bottom: 1em;
  }
  .email-info > * {
    margin: 0;
  }
  .badge {
    font-size: 0.5em; 
    border-radius: 5em; 
    padding: 0.25em 0.5em;
    background-color: var(--navy);
    color: white;
  }
  .muted {
    color: var(--grey-4);
  }
  .flex {
    display: flex;
    gap: 1em;
  }
  article {
    display: flex;
    gap: 3em;
    align-items: center;
    justify-content: center;
  }
  article.start {
    text-align: right;
    align-items: start;
  }
  article.start > div:first-of-type {
    flex: 0 2 30%;
  }
  article.start > form {
    flex-grow: 1;
  }
</style>